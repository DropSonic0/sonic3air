ifeq ($(strip $(PSL1GHT)),)
$(error "Please set PSL1GHT in your environment. export PSL1GHT=<path>")
endif

include $(PSL1GHT)/ppu_rules

STATIC = 1

APPID   := SONIC3AIR
TITLE := Sonic 3 A.I.R.

export PATH := $(PATH):$(PS3DEV)/bin

CC        := ppu-gcc
CXX       := ppu-g++
AS        := ppu-as
AR        := ppu-ar
OBJCOPY   := ppu-objcopy
STRIP     := ppu-strip
NM        := ppu-nm
LD        := ppu-ld
PKGCONFIG := pkg-config

CFLAGS    += -D__PS3__ -mcpu=cell -mbig-endian -g -O1 -fno-inline-functions -fno-inline-functions-called-once -fno-optimize-sibling-calls -fno-default-inline -fno-short-enums -fsigned-char
CXXFLAGS   := $(CFLAGS)

PS3_LIBS := -lnet -lsysutil -lsysmodule -lGL -lEGL -lrsx -lgcm_sys -lio -lrt -llv2 -lz

LIBS += $(PS3_LIBS) -lm -lc

LIBPATHS += -L$(PS3DEV)/ppu/lib
INCLUDES += -I$(PS3DEV)/ppu/include

SUFFIX =    .elf
PKGSUFFIX = .self

$(OUTDIR)/$(NAME).self: $(OUTDIR)/$(NAME)$(SUFFIX)
	@echo "CEX self ... $(notdir $@)"
	@mkdir -p $(OUTDIR)
	@$(STRIP) $< -o $(OUTDIR)/$(notdir $<)
	@$(SPRX) $(OUTDIR)/$(notdir $<)
	@$(SELF) $(OUTDIR)/$(notdir $<) $@
	@$(FSELF) $(OUTDIR)/$(notdir $<) $(basename $@).fake.self
